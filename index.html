<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&amp;display=swap"
      rel="stylesheet"
    />
    <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
    <title>Dashboard</title>
  </head>
    <script>
    const API_BASE = "https://gestao-excesso-velocidde-backend-api.onrender.com/api";
  </script>
  <body>
    <div class="loader">
      <h1>Loading<span>....</span></h1>
    </div>
    <div class="page-content index-page">
      <div class="sidebar">
        <div class="brand">
          <i class="fa-solid fa-xmark xmark"></i>
          <h3 class="brand-name">Sistema de Deteção de Excesso de Velocidade</h3>
        </div>
        <ul>
          <li>
            <a href="index.html" class="sidebar-link">
            <i class="fa fa-home"></i>
              <span>Pagina Principal</span>
            </a>
          </li>

          <li>
            <a href="./pages/Registos.html" class="sidebar-link">
              <i class="fa fa-book"></i>
              <span>Registos</span>
            </a>
          </li>

          <li>
            <a href="./pages/Mapa.html" class="sidebar-link">
              <i class="fa fa-map"></i><span>Mapa</span>
            </a>
          </li>

          <li>
            <a href="./pages/Relatorios.html" class="sidebar-link">
           <i class="fa fa-chart-bar"></i>
              <span>Relatórios</span>
            </a>
          </li>

          <li>
            <a href="./pages/Definicoes.html" class="sidebar-link">
              <i class="fa-solid fa-gear fa-fw"></i>
              <span>Definições</span>
            </a>
          </li>

        </ul>
      </div>
      <main>
        <div class="header">
         <i class="fa-solid fa-bars bar-item"></i>
          <div class="search">
            <!--<input type="search" placeholder="Type A Keyword" />-->
            <span></span>
          </div>

          <div class="profile">
            <span class="bell"><i class="fa-regular fa-bell fa-lg"></i></span>

            <img src="./images/Polic.jpg" alt="No Image" />
          </div>
        </div>
        <div class="main-content">
          <div class="title">
            <h1>Pagina Principal</h1>
          </div>
          <div class="main-content-boxes">
            <div class="box first-box">
              <div class="box-section1">
                <div class="box-title">
                  <h2>Mapa de localização de cameras</h2>
                  <p>Visualização das cameras no Mapa</p>
                </div>
             

              </div>
               <div id="IMAGEM-MAPA">
                <div id="map">
                  <img src="images/Me/map1.jfif">
                  
                </div>
   <a href="./pages/Profile.html"> Detalhes </a>

  

              </div>
           
            </div>

          
            <div class="box">
              <div class="box-section1">
                <div class="box-title">
                  <h2>Estatísticas Rápidas</h2>
                  <p>Resumo de Deteções Diárias</p>
                </div>
              </div>
              <div class="fourth-box-section2">
                <div class="small-box">
              <img src="images/Me/Carro.jfif" class="Rapid-Detect-IMGS"> 
                  <span id="Total">250</span>
                  <p>Total de Veículos Detetados</p>
                </div>

                <div class="small-box">
              <img src="images/Me/taco2.jfif" class="Rapid-Detect-IMGS"> 
                  <span id="Speeded">54</span>
                  <p>Em Excesso de Velocidade</p>
                </div>

                <div class="small-box">
             <img src="images/Me/taco1.jfif" class="Rapid-Detect-IMGS"> 
                  <span id="Mais-Alta">190 Km/h</span>
                  <p>Velocidade Mais Alta</p>
                </div>

                <div class="small-box">
                 <img src="images/Me/Street2.jfif" class="Rapid-Detect-IMGS"> 
                  <span id="Vel-Med">100 Km/h</span>
                  <p>Velocidade Média</p>
                </div>
              </div>
            </div>

  
          </div>
        </div>
        <div class="projects-box">
          <div class="box-section1">
            <div class="box-title">
              <h2>Detecções Recentes</h2>
            </div>
          </div>
          <div class="projects-box-section2">
            <table id = "detections-table">
              <thead>
                <tr>
                      <td>ID</td>
                  <td>Hora</td>
                  <td>Localização</td>
                  <td>Matrícula</td>
                  <td>Velocidade</td>
                  <td>Status</td>
                
                </tr>
              </thead>
              <tbody>
      
                
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
     <script>
    // Utility: show/hide loader
    function setLoading(id, on=true) {
      document.getElementById(id).textContent = on ? '⏳' : '';
    }

    // Utility: format timestamp to readable
    function formatDate(ts) {
      if (!ts) return '';
      const d = new Date(ts);
      return d.toLocaleString();
    }
        async function loadDetections() {
      setLoading('detections-loading', true);
      try {
        const res = await fetch(`${API_BASE}/veiculos`);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const rows = await res.json();
        const tbody = document.querySelector('#detections-table tbody');
        tbody.innerHTML = '';
        for (const r of rows) {
          const tr = document.createElement('tr');
          // adapt field names if your API returns different keys
          const id = r.id ?? r.id_deteccao ?? '';
          tr.innerHTML = `<td>${id}</td>
           <td>${r.matricula ?? ''}</td>
             <td>${r.nome_proprietario ?? ''}</td>
                <td>${r.tipo_veiculo ?? ''}</td>
   <td>${formatDate(r.data_registo ?? r.data)}</td> `;
          tbody.appendChild(tr);
        }
      } catch (err) {
        console.error('Error loading detections', err);
      } finally {
        setLoading('detections-loading', false);
      }
    }
        (function init() {
      loadDetections();
    })();
  </script>
    <script src="./js/script.js"></script>
    <script type="text/javascript" src="../JS/all.js"></script>
<script type="text/javascript" src="../JS/POP.js"></script>
  </body>
</html>
